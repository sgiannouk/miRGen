{% extends 'base.html' %}
{% load static %}

{% block title %}miRGen Database{% endblock %}

{% block content %}
<section class="hero-section">
    <div class="hero-content">
        <!-- Hero Icon -->
        <div class="hero-icon">
            <i class="fas fa-flask"></i>
        </div>

        <!-- Hero Title -->
        <h1 class="hero-title">miRGen Database</h1>

        <!-- Hero Subtitle -->
        <p class="hero-subtitle">Explore comprehensive miRNA TSS annotations</p>

        <!-- Search Container -->
        <div class="search-container collision-container" id="searchContainer">
            <form class="search-form" id="searchForm">
                <!-- Organism and miRNA Name Row -->
                <div class="form-row">
                    <!-- Organism Selection -->
                    <div class="form-group organism-group">
                        <label for="organism">Organism</label>
                        <select id="organism" name="organism" required>
                            <option value="human_GRCh38" data-display="Human" selected>Human (GRCh38/hg38)</option>
                            <option value="mouse_GRCm38" data-display="Mouse">Mouse (GRCm38/mm10)</option>
                        </select>
                    </div>

                    <!-- miRNA Name Input -->
                    <div class="form-group">
                        <label for="mirna_name">miRNA Name</label>
                        <input
                            type="text"
                            id="mirna_name"
                            name="mirna_name"
                            placeholder="e.g., hsa-let-7a-5p"
                            required
                            autocomplete="off"
                        >
                    </div>
                </div>

                <!-- Hidden fields for future database integration -->
                <input type="hidden" name="type" value="mirna">
                <input type="hidden" name="organism" id="organismHidden" value="human_GRCh38">

                <!-- Buttons Row -->
                <div class="buttons-row">
                    <!-- Search Button -->
                    <button type="submit" class="search-btn" id="searchBtn">
                        <i class="fas fa-search"></i>
                        Search
                    </button>

                    <!-- Example Button -->
                    <button type="button" class="example-btn" id="exampleBtn">
                        <i class="fas fa-lightbulb"></i>
                        Try Example
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>



<!-- Search Results Container - Moved outside hero section -->
<div class="search-results" id="searchResults" style="display: none;">
    <!-- Basic Information -->
    <div class="result-card">
        <div class="result-header">
            <h3 class="result-title">
                <i class='bx bx-info-circle'></i>
                Basic Information for <span id="mirnaDisplayName" class="copyable-item" title="Click to copy miRNA name">hsa-let-7a-5p</span>
            </h3>
        </div>
        <div class="result-content">
            <div class="info-grid">
                <!-- Left Column -->
                <div class="info-column">
                    <div class="info-row">
                        <span class="info-label">Full Name:</span>
                        <span class="info-value" id="fullName">Homo sapiens (human) hsa-let-7a-1</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Confidence:</span>
                        <span class="info-value" id="confidence">High</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">miRBase Accession:</span>
                        <span class="info-value" id="mirbaseAccession">MI0000060</span>
                    </div>
                    <div class="info-row" id="ensemblRow">
                        <span class="info-label">Ensembl ID:</span>
                        <span class="info-value" id="ensemblId">ENSG00000199165.3</span>
                    </div>
                    <div class="info-row" id="geneNameRow">
                        <span class="info-label">Gene Name:</span>
                        <span class="info-value" id="geneName">MIRLET7A1</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Pre-miRNA Coordinates:</span>
                        <span class="info-value" id="preMirnaCoordinates">chr9:94,175,957-94,176,036(+)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Pre-miRNA Sequence:</span>
                        <span class="info-value" id="sequence">
                            <span class="sequence-wrapper">
                                <span class="sequence-5p">5' - </span>
                                <span class="sequence-text pre-mirna-sequence">UGGGAUGAGGUAGUAGGUUGUAUAGUUUUAGGGUCACACCCACCACUGGGAGAUAACUAUACAAUCUACUGUCUUUCCUA</span>
                                <span class="sequence-3p"> - 3'</span>
                            </span>
                        </span>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="info-column">
                    <div class="info-row">
                        <span class="info-label">Mature miRNAs:</span>
                        <span class="info-value" id="matureMirnas">
                            <div class="multi-line-value">
                                <span class="copyable-item">hsa-let-7a-5p</span>
                                <span class="copyable-item">hsa-let-7a-3p</span>
                            </div>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Mature Accessions:</span>
                        <span class="info-value" id="matureAccessions">
                            <div class="multi-line-value">
                                <span class="copyable-item">MIMAT0000062_2</span>
                                <span class="copyable-item">MIMAT0004481_1</span>
                            </div>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Mature Coordinates:</span>
                        <span class="info-value" id="matureCoordinates">
                            <div class="multi-line-value">
                                <span class="copyable-item">chr9:94,175,962-94,175,983(+)</span>
                                <span class="copyable-item">chr9:94,176,013-94,176,033(+)</span>
                            </div>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Mature Sequences:</span>
                        <span class="info-value" id="matureSequences">
                            <div class="multi-line-value">
                                <span class="copyable-item sequence-item">5' - UGAGGUAGUAGGUUGUAUAGUU - 3'</span>
                                <span class="copyable-item sequence-item">5' - CUAUACAAUCUACUGUCUUUC - 3'</span>
                            </div>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Genome Browser View -->
    <div class="result-card">
        <div class="result-header">
            <h3 class="result-title">
                <span class="material-symbols-outlined" style="color: #FB8F67;">browse</span>
                Genome Browser View
            </h3>
        </div>
        <div class="result-content">
            <div id="genome-browser-container" class="genome-browser-container">
                <!-- Genome Browser will be initialized here -->
            </div>
        </div>
    </div>

    <!-- Main TSS -->
    <div class="result-card">
        <div class="result-header">
            <h3 class="result-title">
                <span class="material-symbols-outlined" style="color: #5fa8d3;">location_on</span>
                Main TSS
            </h3>
            <button class="details-btn" id="mainTssDetails">
                <i class="fas fa-info-circle"></i>
                Show Details
            </button>
        </div>
        <div class="result-content">
            <div class="data-table main-tss-table">
                <div class="table-header">
                    <div class="table-cell">Chromosome</div>
                    <div class="table-cell">Position</div>
                    <div class="table-cell">Strand</div>
                </div>
                <div class="table-row" id="mainTssData" onclick="copyMainTssPosition()" title="Click to copy position in format: chr9:94,166,274(+)">
                    <div class="table-cell">chr9</div>
                    <div class="table-cell">94,166,274</div>
                    <div class="table-cell">+</div>
                </div>
            </div>
            
            <!-- Host Gene Information Section -->
            <div class="host-gene-info" id="hostGeneInfo" style="display: none;">
                <h4>Host Gene Information</h4>
                <div class="info-list" id="hostGeneInfoContent">
                    <div class="info-item">
                        <span class="info-label">Host Gene ID:</span>
                        <span class="info-value">ENSG00000269929.7</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Host Gene Name:</span>
                        <span class="info-value">MIRLET7A1HG</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Host Gene Type:</span>
                        <span class="info-value">lncRNA</span>
                    </div>
                </div>
                <!-- Alternative content when no host gene exists -->
                <div class="no-host-gene" id="noHostGeneContent" style="display: none;">
                    <p>This miRNA does not have an associated host gene.</p>
                </div>
            </div>
            
            <!-- Supporting Evidence Details Section -->
            <div class="supporting-evidence" id="supportingEvidence" style="display: none;">
                <h4>Supporting Evidence Details</h4>
                <div class="evidence-list">
                    <div class="evidence-item">
                        <span class="evidence-label">TSS source:</span>
                        <span class="evidence-value">CLS</span>
                    </div>
                    <div class="evidence-item">
                        <span class="evidence-label">Number of samples supporting:</span>
                        <span class="evidence-value">23</span>
                    </div>
                    <div class="evidence-item">
                        <span class="evidence-label">Observed in:</span>
                        <span class="evidence-value">TpoolA Adult, Testis Adult, Heart Adult, Heart Embryo, Brain Embryo, Brain Adult, iPSC Embryo, WBlood Adult, Liver Embryo, Placenta</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alternative TSSs -->
    <div class="result-card collapsible-card">
        <div class="result-header collapsible-header" id="altTssHeader" onclick="toggleAltTssContainer()">
            <h3 class="result-title">
                <span class="material-symbols-outlined" style="color: #A6808C;">alt_route</span>
                Alternative TSSs
            </h3>
            <button class="collapse-btn" id="altTssToggle">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div class="result-content collapsible-content" id="altTssContent" style="display: none;">
            <div class="data-table alt-tss-table">
                <div class="table-header">
                    <div class="table-cell">Chromosome</div>
                    <div class="table-cell">Position</div>
                    <div class="table-cell">Strand</div>
                    <div class="table-cell">Supporting Evidence</div>
                </div>
                <div class="table-row" id="altTss1" onclick="copyAltTssPosition(1)" title="Click to copy position in format: chr9:94,166,284(+)">
                    <div class="table-cell">
                        <i class="fas fa-chevron-right clickable-evidence" onclick="showAltTssDetails(1, event)" title="Click to view details"></i>
                        chr9
                    </div>
                    <div class="table-cell">94,166,284</div>
                    <div class="table-cell">+</div>
                    <div class="table-cell">CLS</div>
                </div>
                
                <!-- Alternative TSS 1 Details -->
                <div class="alt-tss-details" id="altTssDetails1" style="display: none;">
                    <h4>Alternative TSS 1 Supporting Evidence</h4>
                    <div class="evidence-list">
                        <div class="evidence-item">
                            <span class="evidence-label">TSS source:</span>
                            <span class="evidence-value">CLS</span>
                        </div>
                        <div class="evidence-item">
                            <span class="evidence-label">Number of samples supporting:</span>
                            <span class="evidence-value">Multiple samples</span>
                        </div>
                        <div class="evidence-item">
                            <span class="evidence-label">Observed in:</span>
                            <span class="evidence-value">Various tissue samples</span>
                        </div>
                    </div>
                </div>
                
                <div class="table-row" id="altTss2" onclick="copyAltTssPosition(2)" title="Click to copy position in format: chr9:94,166,278(+)">
                    <div class="table-cell">
                        <i class="fas fa-chevron-right clickable-evidence" onclick="showAltTssDetails(2, event)" title="Click to view details"></i>
                        chr9
                    </div>
                    <div class="table-cell">94,166,278</div>
                    <div class="table-cell">+</div>
                    <div class="table-cell">CLS</div>
                </div>
                
                <!-- Alternative TSS 2 Details -->
                <div class="alt-tss-details" id="altTssDetails2" style="display: none;">
                    <h4>Alternative TSS 2 Supporting Evidence</h4>
                    <div class="evidence-list">
                        <div class="evidence-item">
                            <span class="evidence-label">TSS source:</span>
                            <span class="evidence-value">CLS</span>
                        </div>
                        <div class="evidence-item">
                            <span class="evidence-label">Number of samples supporting:</span>
                            <span class="evidence-value">Multiple samples</span>
                        </div>
                        <div class="evidence-item">
                            <span class="evidence-label">Observed in:</span>
                            <span class="evidence-value">Various tissue samples</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transcription Factors -->
    <div class="result-card collapsible-card">
        <div class="result-header collapsible-header" id="tfHeader" onclick="toggleTfContainer()">
            <h3 class="result-title">
                <span class="material-symbols-outlined" style="color: #FFB238;">tune</span>
                Transcription Factors
            </h3>
            <button class="collapse-btn" id="tfToggle">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div class="result-content collapsible-content" id="tfContent" style="display: none;">
            <!-- TF Filters -->
            <div class="tf-filters">
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>TF Type:</label>
                        <div class="custom-multiselect" id="tfTypeMultiselect">
                            <button class="multiselect-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <span class="selected-text">All Types</span>
                                <span class="dropdown-arrow">▼</span>
                            </button>
                            <ul class="multiselect-dropdown">
                                <li><label class="multiselect-item">
                                    <input type="checkbox" value="Cell line" checked>
                                    <span>Cell line</span>
                                </label></li>
                                <li><label class="multiselect-item">
                                    <input type="checkbox" value="Brain" checked>
                                    <span>Brain</span>
                                </label></li>
                                <li><label class="multiselect-item">
                                    <input type="checkbox" value="Liver" checked>
                                    <span>Liver</span>
                                </label></li>
                                <li><label class="multiselect-item">
                                    <input type="checkbox" value="Heart" checked>
                                    <span>Heart</span>
                                </label></li>
                                <li><label class="multiselect-item">
                                    <input type="checkbox" value="Kidney" checked>
                                    <span>Kidney</span>
                                </label></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>Score Range:</label>
                        <div class="score-range">
                            <input type="range" id="scoreMin" min="0" max="1" step="0.01" value="0">
                            <span id="scoreMinValue">0</span>
                            <span>to</span>
                            <input type="range" id="scoreMax" min="0" max="1" step="0.01" value="1">
                            <span id="scoreMaxValue">1</span>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button id="applyFilters" class="filter-btn">Apply</button>
                        <button id="resetFilters" class="filter-btn reset-btn">Reset</button>
                        
                        <!-- Download Button with Dropdown -->
                        <div class="download-container">
                            <div class="btn-group">
                                <button type="button" class="btn btn-danger" id="downloadBtn">DOWNLOAD</button>
                                <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" data-format="tsv">tsv</a></li>
                                    <li><a class="dropdown-item" href="#" data-format="csv">csv</a></li>
                                    <li><a class="dropdown-item" href="#" data-format="excel">excel</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="data-table tf-table">
                <div class="table-header">
                    <div class="table-cell">TF Name</div>
                    <div class="table-cell">Start</div>
                    <div class="table-cell">End</div>
                    <div class="table-cell">Score</div>
                    <div class="table-cell">Type</div>
                </div>
                <div id="tfTableBody">
                    <!-- Table rows will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Results Summary -->
            <div class="results-summary">
                Showing <span id="currentCount">0</span> of <span id="totalCount">0</span> results
            </div>
            
            <!-- Pagination -->
            <div class="pagination">
                <button id="prevPage" disabled>Previous</button>
                <span id="pageInfo">Page 1 of 1</span>
                <button id="nextPage">Next</button>
            </div>
        </div>
    </div>

    <!-- External Resources -->
    <div class="result-card">
        <div class="result-header">
            <h3 class="result-title">External Resources</h3>
        </div>
        <div class="result-content">
            <div class="external-links">
                <a href="https://www.mirbase.org/" class="external-btn" id="mirbaseLink" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-external-link-alt"></i>
                    miRBase
                </a>
                <a href="#" class="external-btn" id="ensemblLink" target="_blank" rel="noopener noreferrer" style="display: none;">
                    <i class="fas fa-external-link-alt"></i>
                    Ensembl
                </a>
                <a href="#" class="external-btn" id="tarbaseLink" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-external-link-alt"></i>
                    TarBase
                </a>
                <a href="#" class="external-btn" id="mirnaTissueAtlasLink" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-external-link-alt"></i>
                    miRNATissueAtlas
                </a>
                <a href="#" class="external-btn" id="ucscLink" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-external-link-alt"></i>
                    UCSC Browser
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=alt_route,browse,location_on,tune" />
<link rel="stylesheet" href="{% static 'css/home_style.css' %}">
<link rel="stylesheet" href="{% static 'css/genome_browser_style.css' %}">
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/home_script.js' %}"></script>
    <script src="{% static 'js/genome_browser_script.js' %}"></script>
{% endblock %}
